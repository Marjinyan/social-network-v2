paths:
    /follow/requests:
        get:
            tags: [Follow]
            summary: Get follow requests
            description: Returns pending follow requests (approved = 0) for the authenticated user.
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: Requests returned
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    requests:
                                        type: array
                                        items:
                                            $ref: "#/components/schemas/FollowRequest"
                                required: [requests]
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "403":
                    $ref: "#/components/responses/Forbidden"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /follow/requests/accept:
        patch:
            tags: [Follow]
            summary: Accept follow request
            description: Sets an existing follow request's approved flag to true.
            security:
                - bearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/RequestEdge"
            responses:
                "200":
                    description: Request accepted
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MessageResponse"
                            examples:
                                ok:
                                    value:
                                        message: "Follow request accepted"
                "404":
                    description: Request not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MessageResponse"
                            examples:
                                not_found:
                                    value:
                                        message: "Not found"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "403":
                    $ref: "#/components/responses/Forbidden"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /follow/requests/decline:
        patch:
            tags: [Follow]
            summary: Decline follow request
            description: Deletes an existing follow request.
            security:
                - bearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/RequestEdge"
            responses:
                "200":
                    description: Request declined
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MessageResponse"
                            examples:
                                ok:
                                    value:
                                        message: "Follow request declined"
                "404":
                    description: Request not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MessageResponse"
                            examples:
                                not_found:
                                    value:
                                        message: "Not found"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "403":
                    $ref: "#/components/responses/Forbidden"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /follow/followings:
        post:
            tags: [Follow]
            summary: Resolve followings list
            description: |
                Accepts a list of followingsInfo objects and returns user records for each `to`.
                (This is implemented as POST because you send the list in the body.)
            security:
                - bearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                followingsInfo:
                                    type: array
                                    items:
                                        $ref: "#/components/schemas/FollowInfoTo"
                            required: [followingsInfo]
            responses:
                "200":
                    description: Followings returned
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    followings:
                                        type: array
                                        items:
                                            $ref: "#/components/schemas/UserSafe"
                                required: [followings]
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "403":
                    $ref: "#/components/responses/Forbidden"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /follow/followers:
        post:
            tags: [Follow]
            summary: Resolve followers list
            description: |
                Accepts a list of followersInfo objects and returns user records for each `from`.
                (This is implemented as POST because you send the list in the body.)
            security:
                - bearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                followersInfo:
                                    type: array
                                    items:
                                        $ref: "#/components/schemas/FollowInfoFrom"
                            required: [followersInfo]
            responses:
                "200":
                    description: Followers returned
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    followers:
                                        type: array
                                        items:
                                            $ref: "#/components/schemas/UserSafe"
                                required: [followers]
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "403":
                    $ref: "#/components/responses/Forbidden"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /follow/{id}:
        post:
            tags: [Follow]
            summary: Follow / unfollow / request / cancel request
            description: |
                Toggles follow state against a target user by id.
                Behavior depends on whether the target account is private and whether a Follow row already exists.

                - Public target:
                  - If already followed: deletes row → 200 Unfollowed
                  - If not followed: creates row approved=true → 200 Followed
                - Private target:
                  - If pending request exists (approved=false): deletes row → 200 Cancelled
                  - If no row exists: creates row approved=false → 201 Requested
                  - If approved row exists: deletes row → 200 Unfollowed
            security:
                - bearerAuth: []
            parameters:
                - in: path
                  name: id
                  required: true
                  schema:
                      type: integer
                  example: 45
            responses:
                "200":
                    description: Follow state updated (followed/unfollowed/cancelled)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FollowActionResponse"
                            examples:
                                followed:
                                    value:
                                        status: "Followed"
                                        result:
                                            id: 10
                                            from: 113
                                            to: 45
                                            approved: true
                                unfollowed:
                                    value:
                                        status: "Unfollowed"
                                cancelled:
                                    value:
                                        status: "Cancelled"
                "201":
                    description: Follow request created for private account
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FollowActionResponse"
                            examples:
                                requested:
                                    value:
                                        status: "Requested"
                                        result:
                                            id: 11
                                            from: 113
                                            to: 45
                                            approved: false
                "400":
                    description: Invalid operation (e.g., following yourself)
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FollowValidatorError"
                            examples:
                                self_follow:
                                    value:
                                        status: "Invalid"
                                        message: "You cannot follow yourself"
                "404":
                    description: Target user or request not found
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FollowNotFoundError"
                            examples:
                                user_not_found:
                                    value:
                                        status: "NotFound"
                                        message: "User not found"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "403":
                    $ref: "#/components/responses/Forbidden"
                "500":
                    $ref: "#/components/responses/InternalServerError"

components:
    schemas:
        MessageResponse:
            type: object
            properties:
                message:
                    type: string
            required: [message]

        # Body schema for accept/decline
        RequestEdge:
            type: object
            properties:
                from:
                    type: integer
                    example: 113
                to:
                    type: integer
                    example: 45
            required: [from, to]

        # Returned item in GET /follow/requests
        FollowRequest:
            type: object
            properties:
                id:
                    type: integer
                    example: 11
                sender:
                    $ref: "#/components/schemas/UserSafe"
            required: [id, sender]

        FollowInfoTo:
            type: object
            properties:
                to:
                    type: integer
                    example: 45
            required: [to]

        FollowInfoFrom:
            type: object
            properties:
                from:
                    type: integer
                    example: 45
            required: [from]

        FollowRow:
            type: object
            properties:
                id:
                    type: integer
                    example: 11
                from:
                    type: integer
                    example: 113
                to:
                    type: integer
                    example: 45
                approved:
                    type: boolean
                    example: false
            required: [id, from, to, approved]

        FollowActionResponse:
            type: object
            properties:
                status:
                    type: string
                    example: "Followed"
                result:
                    $ref: "#/components/schemas/FollowRow"
            required: [status]

        FollowValidatorError:
            type: object
            properties:
                status:
                    type: string
                    example: "Invalid"
                message:
                    type: string
                    example: "You cannot follow yourself"
            required: [status, message]

        FollowNotFoundError:
            type: object
            properties:
                status:
                    type: string
                    example: "NotFound"
                message:
                    type: string
                    example: "User not found"
            required: [status, message]

        # If you already have this schema elsewhere, reuse it instead of duplicating.
        UserSafe:
            type: object
            description: Safe user fields (based on SAFE_USER constant).
            properties:
                id:
                    type: integer
                    example: 45
                username:
                    type: string
                    example: "john_doe"
                firstName:
                    type: string
                    example: "John"
                lastName:
                    type: string
                    example: "Doe"
                avatar:
                    type: string
                    nullable: true
                    example: "avatar.png"
                bio:
                    type: string
                    nullable: true
                    example: "Hello"
                theme:
                    type: string
                    example: "system"
                isAccountPrivate:
                    type: boolean
                    example: true

    responses:
        Unauthorized:
            description: Missing/invalid auth token
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/MessageResponse"
                    examples:
                        unauthorized:
                            value:
                                message: "Unauthorized"

        Forbidden:
            description: Authenticated but not allowed
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/MessageResponse"
                    examples:
                        forbidden:
                            value:
                                message: "Forbidden"

        InternalServerError:
            description: Server error
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/MessageResponse"
                    examples:
                        error:
                            value:
                                message: "Internal server error"
